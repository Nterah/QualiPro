{% extends "base.html" %}
{% block title %}Reminders | PQP{% endblock %}
{% block content %}
<h3 class="mb-3">Overdue Reminders</h3>
<div class="card">
  <div class="card-header">Projects ({{ items|length }})</div>
  <div class="table-responsive">
    <table class="table table-striped table-sm mb-0">
      <thead class="table-light"><tr><th>Code</th><th>Project Manager</th><th>Actions</th></tr></thead>
      <tbody>
        {% for it in items %}
          <tr>
            <td class="fw-semibold">{{ it.code }}</td>
            <td>{{ it.pm }}</td>
            <td class="d-flex gap-2">
              <button class="btn btn-sm btn-outline-warning" onclick="sendReminders('{{ it.code }}')">
                Send Reminder (demo)
              </button>
              <a class="btn btn-sm btn-outline-dark" href="/pqp/form?project_code={{ it.code }}">Open PQP</a>
            </td>
          </tr>
        {% else %}
          <tr><td colspan="3" class="text-center text-muted">No projects.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<pre id="log" class="small mt-3 bg-white border rounded p-2" style="max-height:240px; overflow:auto"></pre>
{% endblock %}

{% block scripts %}
<script>
  function sendReminders(code) {
    const log = document.getElementById('log');
    fetch(`/pqp/${encodeURIComponent(code)}/email/reminders`, { method: 'POST' })
      .then(r => r.json())
      .then(j => { log.textContent = JSON.stringify(j, null, 2); })
      .catch(e => { log.textContent = String(e); });
  }
</script>
{% endblock %}
